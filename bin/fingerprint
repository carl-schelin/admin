#!/bin/ksh

# Carl Schelin
# creates an identification file for each server
# modified to look for a passed servers file so other groups can participate.

ADMIN=/usr/local/admin
OUTPUT=$ADMIN/logs/fingerprint
SERVERS="servers"

if [[ ! -z "$1" ]]
then
  if [[ -f $ADMIN/etc/$1 ]]
  then
    SERVERS=$1
  fi
fi

cd /usr/local/httpd/bin

for i in `grep -v "^#" $ADMIN/etc/$SERVERS | cut -f1 -d:`
do
  SVRPATH=$ADMIN/servers/$i

# make the directory if it doesn't exist
  if [[ ! -d $SVRPATH ]]
  then
    mkdir $SVRPATH
  fi
  
# create the fingerprint file
  /usr/local/bin/php /usr/local/httpd/bin/fingerprint.php $i > $SVRPATH/fingerprint

  cat $SVRPATH/fingerprint

# copy it to the target server
  scp $SVRPATH/fingerprint $i:/opt/intrado/etc/
  scp $SVRPATH/fingerprint $i:/opt/unixsuite/etc/

done

